    <main class="content center">
      <h2>
        Welcome back!
      </h2>
      <form id="form" method="POST" action="/auth/username" class="center">
        <p class="instructions">Don't have an account yet? Register now</p>
        <label class="mdc-text-field mdc-text-field--outlined">
          <span class="mdc-notched-outline">
            <span class="mdc-notched-outline__leading"></span>
            <span class="mdc-notched-outline__notch">
              <span class="mdc-floating-label" id="username-label">username</span>
            </span>
            <span class="mdc-notched-outline__trailing"></span>
          </span>
          <input
           type="text"
           id="username"
           class="mdc-text-field__input"
           aria-labelledby="username-label"
           name="username"
           autocomplete="username webauthn"
           size="30"
           autofocus />
        </label>
        <input type="password" class="hidden" name="password" />
        <md-filled-button type="submit">Continue</md-filled-button>
        <!-- <ol class="instructions narrow">
          <li>Sign in with a random username and password.</li>
          <li>Create a passkey.</li>
          <li>Sign out.</li>
          <li>Click or tap on the username input field to show an autofill dialog.</li>
          <li>Select a passkey.</li>
          <li>Authenticate.</li>
          <li>You are signed in.</li>
        </ol> -->
      </form>
    </main>
    <script src="https://unpkg.com/material-components-web@14.0.0/dist/material-components-web.min.js"></script>
    <script type="module">
      import { $, _fetch, loading } from '/scripts/client.js';
      import { authenticate } from '/scripts/passkeys.js';
      new mdc.textField.MDCTextField($('.mdc-text-field'));

      const form = $('#form');
      // When the form is submitted, proceed to the password form.
      form.addEventListener('submit', async s => {
        s.preventDefault();
        const form = new FormData(s.target);
        const cred = {};
        form.forEach((v, k) => cred[k] = v);
        _fetch(s.target.action, cred)
        .then(user => {
          location.href = '/password';
        }).catch(e => {
          loading.stop();
          console.error(e.message);
          alert(e);
        });
      });

      // Feature detection: check if WebAuthn and conditional UI are supported.
      if (window.PublicKeyCredential &&
          PublicKeyCredential.isConditionalMediationAvailable) {
        try {
          const cma= await PublicKeyCredential.isConditionalMediationAvailable();
          if (cma) {
            // If a conditional UI is supported, invoke the conditional `authenticate()` immediately.
            const user = await authenticate(true);
            if (user) {
              // When the user is signed in, redirect to the home page.
              $('#username').value = user.username;
              loading.start();
              location.href = '/home';
            } else {
              throw new Error('User not found.');
            }
          }
        } catch (e) {
          loading.stop();
          console.error(e);
          // `NotAllowedError` indicates a user cancellation.
          if (e.name !== 'NotAllowedError') {
            alert(e.message);
          }
        }
      }

    </script>